<!DOCTYPE html><html lang="en"><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>User guide - MIXT documentation (version 1.2.2)</title><link rel="stylesheet" type="text/css" href="typeset.css" /><link rel="stylesheet" type="text/css" href="global.css" /><style type="text/css">
</style><body><nav id="main-menu" class="menu"><p><a href="#top">Table of content</a></p><ul><li><a href="#start" class="menu-rst-section">Start</a></li><li><a href="#spacing" class="menu-rst-section">Spacing</a></li><li><details><summary><a href="#props" class="menu-rst-section">Props</a></summary><ul><li><a href="#props_proptypes-class" class="menu-rst-section">PropTypes class</a></li><li><a href="#props_props-and-children" class="menu-rst-section">Props and children</a></li><li><a href="#props_passing-props" class="menu-rst-section">Passing props</a></li><li><details><summary><a href="#props_validation" class="menu-rst-section">Validation</a></summary><ul><li><a href="#props_validation_numbers" class="menu-rst-section">Numbers</a></li><li><a href="#props_validation_booleans-and-other-special-cases" class="menu-rst-section">Booleans and other special cases</a></li></ul></details></li><li><a href="#props_required-props" class="menu-rst-section">Required props</a></li><li><a href="#props_default-props" class="menu-rst-section">Default props</a></li><li><a href="#props_choices" class="menu-rst-section">Choices</a></li><li><a href="#props_default-choices" class="menu-rst-section">Default choices</a></li><li><a href="#props_advanced-types" class="menu-rst-section">Advanced types</a></li></ul></details></li><li><a href="#dev-mode" class="menu-rst-section">dev-mode</a></li><li><a href="#components-cascade" class="menu-rst-section">Components cascade</a></li><li><details><summary><a href="#overriding-a-component" class="menu-rst-section">Overriding a component</a></summary><ul><li><a href="#overriding-a-component_inheritance" class="menu-rst-section">Inheritance</a></li><li><a href="#overriding-a-component_parent-components" class="menu-rst-section">Parent components</a></li><li><a href="#overriding-a-component_proptypes-dryness" class="menu-rst-section">PropTypes DRYness</a></li><li><a href="#overriding-a-component_function" class="menu-rst-section">Function</a></li><li><a href="#overriding-a-component_higher-order-components" class="menu-rst-section">Higher-order components</a></li></ul></details></li><li><a href="#context" class="menu-rst-section">Context</a></li><li><details><summary><a href="#style-and-javascript" class="menu-rst-section">Style and Javascript</a></summary><ul><li><details><summary><a href="#style-and-javascript_collectors" class="menu-rst-section">Collectors</a></summary><ul><li><a href="#style-and-javascript_collectors_collector-collect" class="menu-rst-section">Collector.Collect</a></li><li><a href="#style-and-javascript_collectors_render-js-css-methods" class="menu-rst-section">render_[js|css] methods</a></li><li><a href="#style-and-javascript_collectors_render-js-css-global-methods" class="menu-rst-section">render_[js|css]_global methods</a></li><li><a href="#style-and-javascript_collectors_references" class="menu-rst-section">references</a></li></ul></details></li></ul></details></li><li><a href="#user-guide-conclusion" class="menu-rst-section">User guide conclusion</a></li><li><a href="#next" class="menu-rst-section">Next</a></li></ul></nav><main><h1 class="h"><a href="index.html" title="Back to documentation index">MIXT documentation</a>: User guide</h1><div class="doc"><div class="manual"><p><p>This user-guide will introduce you through the whole set of features provided by Mixt, step by step.  
</p>Note: You can find the <em>final</em> code of this user guide in <code>src/mixt/examples/user_guide</code> (you'll find <code>mixt.py</code> and <code>pure_python.py</code>).</p><p>Run it with:</p><div class="code"><pre><span></span>python -m mixt.examples.user_guide
</pre></div>
<details id="start" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Start</h2><a class="permalink" href="#start" title="Permalink to here">¶</a></summary><div class="content"><p>Let's create a... todo list, yeah!</p><p>But before, remember. This is not React, it's not on the browser and there is no Javascript involved here. We only talk about rendering some HTML.</p><p>But you can do what you want with it. Add javascript handlers, simple forms...</p><p>Talking about forms...</p><p>In a todo list, we want to be able to add a todo. It's a simple text input.</p><p>So let's create our first component, the <code>TodoForm</code>. We want a form with an input text and a button.</p><p>A component is a subclass of the <code>Element</code> class, with a <code>render</code> method you have to write.</p><div class="code"><pre><span></span><span class="c1"># coding: mixt</span>

<span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">html</span>  <span class="c1"># html is mandatory to resolve html tags</span>

<span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>  <span class="c1"># Ignore the ``context`` argument for now.</span>
        <span class="k">return</span> \  <span class="c1"># The ``\`` is only for a better indentation below</span>
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;???&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="n">Todo</span><span class="p">:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
<p>Note that this could have been written as a simple function:</p><div class="code"><pre><span></span><span class="c1"># coding: mixt</span>

<span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">html</span>

<span class="k">def</span> <span class="nf">TodoForm</span><span class="p">():</span>
    <span class="k">return</span> \
        <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;???&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="n">Todo</span><span class="p">:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
<p>When print the component, these two will give the same result:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;???&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div></details><details id="spacing" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Spacing</h2><a class="permalink" href="#spacing" title="Permalink to here">¶</a></summary><div class="content"><p>Notice how it is formatted: no space between tags. In fact, it's <a href="https://reactjs.org/docs/jsx-in-depth.html#string-literals-1">like in JSX</a>:</p><blockquote><p>JSX removes whitespace at the beginning and ending of a line. It also removes blank lines. New lines adjacent to tags are removed; new lines that occur in the middle of string literals are condensed into a single space</p></blockquote><p>To add a space, or a newline, you can pass some python. Let's, as an example, add a newline before the label:</p><div class="code"><pre><span></span><span class="c1">#...</span>
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;???&quot;</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">}</span><span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="n">Todo</span><span class="p">:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
<span class="c1">#...</span>
</pre></div>
<p>Now we have this output:</p><div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div></details><details id="props" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Props</h2><a class="permalink" href="#props" title="Permalink to here">¶</a></summary><div class="content"><p>Now let's go further.</p><p>Notice the <code>action</code> attribute of the form. We need to pass something. But hard-coding it does not sound right. Wwe need to pass it to the component.</p><p><code>Mixt</code> has, like <code>React</code>, the concept of properties, aka &quot;props&quot;.</p><details id="props_proptypes-class" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">PropTypes class</h3><a class="permalink" href="#props_proptypes-class" title="Permalink to here">¶</a></summary><div class="content"><p>In <code>Mixt</code>, we define them with a type, in a class inside our component, named <code>PropTypes</code>:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="n">Todo</span><span class="p">:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
<p>Here we defined a prop named <code>add_url</code> which must be a string (<code>str</code>). This uses the <a href="https://docs.python.org/3.6/library/typing.html">python typing syntax</a>.</p><p>And notice how we changed the <code>action</code> attribute of the <code>form</code> tag. It's now <code>{self.add_url}</code> instead of <code>&quot;???&quot;</code>.</p><p>When attributes are passed between curly braces, they are interpreted as pure python at run-time. In fact, as the <code>mixt</code> parser will convert the whole file to pure python before letting the python interpreter running it, it will stay the same, only the html around will be converted. So there is no penalty to do this.</p></div></details><details id="props_props-and-children" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Props and children</h3><a class="permalink" href="#props_props-and-children" title="Permalink to here">¶</a></summary><div class="content"><p>Look how this would look like if our component was written in pure python:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">html</span>

<span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Form</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url</span> <span class="p">)(</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">()(</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Raw</span><span class="p">(</span><span class="s2">&quot;New Todo: &quot;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">InputText</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;todo&#39;</span><span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span><span class="p">)(</span>
                <span class="n">html</span><span class="o">.</span><span class="n">Raw</span><span class="p">(</span><span class="s2">&quot;Add&quot;</span><span class="p">)</span>  <span class="c1"># or html.Rawhtml(text=&quot;Add&quot;)</span>
            <span class="p">),</span>
        <span class="p">)</span>
</pre></div>
<p>Notice how the props are passed to a component as named arguments and how <code>action</code> is passed: <code>action=self.add_url</code>.</p><p>This pure-python component also shows you how it works: props are passed as named argument to the component class, then this component is called, passing children components as positional arguments to the call:</p><div class="code"><pre><span></span><span class="n">ComponentClass</span><span class="p">(</span><span class="n">prop1</span><span class="o">=</span><span class="s2">&quot;val1&quot;</span><span class="p">,</span> <span class="n">prop2</span><span class="o">=</span><span class="s2">&quot;val2&quot;</span><span class="p">)(</span>
    <span class="n">Children1</span><span class="p">(),</span>
    <span class="n">Children2</span><span class="p">(),</span>
<span class="p">)</span>
</pre></div>
<p>What are children? Children are tags inside other tags.</p><p>In <code>&lt;div id=&quot;divid&quot;&gt;&lt;span /&gt;&lt;p&gt;foo&lt;/p&gt;&lt;/div&gt;</code>, we have:</p><ul><li><p>a <code>html.Div</code> component, with a prop <code>id</code> and two children:</p><ul><li><p>a <code>html.Span</code> component, without children</p></li><li><p>a <code>html.P</code> component with one child:</p><ul><li><p>a <code>html.RawHtml</code> component with the text &quot;foo&quot;</p></li></ul></li></ul></li></ul><p>Note that you can play with props and children. First the version in pure-python to show how it works:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prop1&quot;</span><span class="p">:</span> <span class="s2">&quot;val1&quot;</span><span class="p">,</span> <span class="s2">&quot;prop2&quot;</span><span class="p">:</span> <span class="s2">&quot;val2&quot;</span><span class="p">}</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">Children1</span><span class="p">(),</span> <span class="n">Children2</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">ComponentClass</span><span class="p">(</span><span class="o">**</span><span class="n">props</span><span class="p">)(</span><span class="o">*</span><span class="n">children</span><span class="p">)</span>
    <span class="c1"># You can pass a list of children to to the call, so this would produce the same result:</span>
    <span class="c1"># ComponentClass(**props)(children)</span>
</pre></div>
<p>Then the <code>mixt</code> version:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prop1&quot;</span><span class="p">:</span> <span class="s2">&quot;val1&quot;</span><span class="p">,</span> <span class="s2">&quot;prop2&quot;</span><span class="p">:</span> <span class="s2">&quot;val2&quot;</span><span class="p">}</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Children1</span><span class="o">/&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Children2</span><span class="o">/&gt;</span><span class="p">]</span>

    <span class="k">return</span> <span class="o">&lt;</span><span class="n">ComponentClass</span> <span class="p">{</span><span class="o">**</span><span class="n">props</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="o">*</span><span class="n">children</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">ComponentClass</span><span class="o">&gt;</span>
    <span class="c1"># or, the same, passing the children as a list:</span>
    <span class="c1"># return &lt;ComponentClass {**props}&gt;{children}&lt;/ComponentClass&gt;</span>
</pre></div>
</div></details><details id="props_passing-props" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Passing props</h3><a class="permalink" href="#props_passing-props" title="Permalink to here">¶</a></summary><div class="content"><p>Now let's go back to our props <code>add_url</code>.</p><p>How to pass it to the component?</p><p>The exact same way we passed attributes to HTML tags: they are in fact props defined in the HTML compoments (defined in <code>mixt.html</code>). We support every HTML tags that, at the time of the writing, are valid (not deprecated) in HTML5, with their attributes (excluding the deprecated ones).</p><p>So let's do this:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>OK, we have our prop present in the rendered HTML.</p></div></details><details id="props_validation" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Validation</h3><a class="permalink" href="#props_validation" title="Permalink to here">¶</a></summary><div class="content"><p>What if we don't pass a string? We said in <code>PropTypes</code> that we wanted a string...</p><details id="props_validation_numbers" class="doc-part rst-section" tabindex="-1" open><summary><h4 class="h">Numbers</h4><a class="permalink" href="#props_validation_numbers" title="Permalink to here">¶</a></summary><div class="content"><p>Let's try it:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="mi">1</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>It works! But... it's not a string!! In fact, there is a special case for numbers, you can pass them as numbers instead of strings and they are converted if needed...</p></div></details><details id="props_validation_booleans-and-other-special-cases" class="doc-part rst-section" tabindex="-1" open><summary><h4 class="h">Booleans and other special cases</h4><a class="permalink" href="#props_validation_booleans-and-other-special-cases" title="Permalink to here">¶</a></summary><div class="content"><p>So let's try something else.</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="kc">True</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">add_url</span><span class="p">:</span> <span class="err">`</span><span class="kc">True</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">bool</span><span class="s1">&#39;&gt;, expected: &lt;class &#39;</span><span class="nb">str</span><span class="s1">&#39;&gt;)</span>
</pre></div>
<p>And it's the same if we pass <code>True</code> in python</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="p">{</span><span class="kc">True</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">add_url</span><span class="p">:</span> <span class="err">`</span><span class="kc">True</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">bool</span><span class="s1">&#39;&gt;, expected: &lt;class &#39;</span><span class="nb">str</span><span class="s1">&#39;&gt;)</span>
</pre></div>
<p>Ok, let's trick the system and pass <code>&quot;True&quot;</code>, as a string.</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">add_url</span><span class="p">:</span> <span class="err">`</span><span class="kc">True</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">bool</span><span class="s1">&#39;&gt;, expected: &lt;class &#39;</span><span class="nb">str</span><span class="s1">&#39;&gt;)</span>
</pre></div>
<p>Still the same, but here we passed a string! Yes but there are 4 values that are always evaluated to what they seems to be:</p><ul><li><p>True</p></li><li><p>False</p></li><li><p>None</p></li><li><p>NotProvided (a special value meaning &quot;not set&quot; which is different that <code>None</code>)</p></li></ul><p>The only way to pass one of these values as a string, is to pass them via python, as a string:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;True&quot;</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;True&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>Except these 4 values, and numbers, every value that is passed to an attribute is considered a string. Even if there is no quotes, like in html in HTML5, where quotes are not mandatory for strings without some characters (no spaces, no <code>/</code>...).</p><p>To pass something else, you must surround the value in curly braces (and in this cases there is no need for quotes around the curly braces.</p><p>Ok, now we are sure that we only accept string.... but what if I pass nothing? And... what is &quot;nothing&quot;?</p><p>Let's start with an empty string in python:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>Ok it works, we wanted a string, we have a string.</p><p>Now let's pass this empty string directly:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>It still works, because it's still a string. Let's remove the quotes, to see.</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GeneralParserError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">mixt</span> <span class="n">parser</span><span class="o">&gt;</span> <span class="n">Unclosed</span> <span class="n">Tags</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;</span>
</pre></div>
<p>Hum yeah, this is not valid HTML. So let's remove the <code>=</code>:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">add_url</span><span class="p">:</span> <span class="err">`</span><span class="kc">True</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">bool</span><span class="s1">&#39;&gt;, expected: &lt;class &#39;</span><span class="nb">str</span><span class="s1">&#39;&gt;)</span>
</pre></div>
<p>WHAT? Yes, think about HTML5 attributes like <code>required</code>, <code>checked</code>... They only need to be present as an attribute, without value, to be considered <code>True</code>. So when an attribute doesn't have any value, it's a boolean, and it's <code>True</code>.</p><p>In addition to not pass a value, those two other ways are valid in HTML5 for a boolean to by <code>True</code>:</p><ul><li><p>pass an empty string: <code>required=&quot;&quot;</code></p></li><li><p>pass the name of the attribute: <code>required=&quot;required&quot;</code></p></li></ul><p>For your convenience, we added another way:</p><ul><li><p>pass <code>True</code> (case does not matter), as python or as a string: <code>required=True</code>, <code>required={True}</code>, <code>required=&quot;true&quot;</code></p></li></ul><p>And its counterpart, to pass <code>False</code>:</p><ul><li><p>pass <code>False</code> (case does not matter), as python or as a string: <code>required=False</code>, <code>required={False}</code>, <code>required=&quot;false&quot;</code></p></li></ul></div></details></div></details><details id="props_required-props" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Required props</h3><a class="permalink" href="#props_required-props" title="Permalink to here">¶</a></summary><div class="content"><p>Ok for the boolean attributes. It's not our case. The last thing we can do is to not set the attribute at all:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">/&gt;</span><span class="p">)</span>
<span class="c1"># this is the same: ``print(&lt;TodoForm add_url=NotProvided /&gt;)```</span>
<span class="c1"># (``NotProvided`` must be imported from ``mixt``)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">UnsetPropError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">add_url</span><span class="p">:</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
</pre></div>
<p>It's understandable: we try to access a prop that is not set, of course we cannot use it.</p><p>But what if we don't access it? If we don't print the component, it won't be rendered:</p><div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">/&gt;</span>
</pre></div>
<div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">at</span> <span class="mh">0x7fbd18ea5630</span><span class="o">&gt;</span>
</pre></div>
<p>So we can create an instance but it will fail at render time. But there is a way to prevent that.</p><p>By default, all properties are optional. And you don't have to use the <code>Optional</code> type from the python <code>typing</code> module for that, it would be cumbersome to do it for each prop.</p><p>Instead, <code>mixt</code> provides a type named <code>Required</code> that you use the same way than <code>Optionnal</code>.</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Required</span><span class="p">,</span> <span class="n">html</span>

<span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="c1"># ...</span>
</pre></div>
<p>So we just said we wanted a string, and that it is required.</p><p>Let's try again to create it without the prop:</p><div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">/&gt;</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequiredPropError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">add_url</span><span class="p">:</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">required</span> <span class="n">prop</span> <span class="n">but</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
</pre></div>
<p>Now we have the exception raised earlier in our program.</p></div></details><details id="props_default-props" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Default props</h3><a class="permalink" href="#props_default-props" title="Permalink to here">¶</a></summary><div class="content"><p>To see other possibilities in props, let's add a new one to change the text label. But we don't want to make it required, and instead have a default value.</p><p>For this, it's as easy as adding a value to the prop in the <code>PropTypes</code> class:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;New Todo&#39;</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">}:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
<p>Now let's try it without passing the prop:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span><span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New Todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>And if we pass one:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Thing to do&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Thing to do: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>It works as expected.</p><p>Note that you cannot give a default value while having the prop <code>Required</code>. It makes no sense, so it's checked as soon as possible, while the <code>class</code> is constructed:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;New Todo&#39;</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">PropTypeRequiredError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">label</span><span class="p">:</span> <span class="n">a</span> <span class="n">prop</span> <span class="k">with</span> <span class="n">a</span> <span class="n">default</span> <span class="n">value</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">required</span>
</pre></div>
<p>And of course the default value must match the type!</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">}</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">label</span><span class="p">:</span> <span class="err">`</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">}</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">dict</span><span class="s1">&#39;&gt;, expected: &lt;class &#39;</span><span class="nb">str</span><span class="s1">&#39;&gt;)</span>
</pre></div>
</div></details><details id="props_choices" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Choices</h3><a class="permalink" href="#props_choices" title="Permalink to here">¶</a></summary><div class="content"><p>Another thing we want to do in our component is to let it construct the label, passing it a &quot;type&quot; of todo, but limiting the choices. For this we can use the <code>Choices</code> type:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">Choices</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Required</span><span class="p">,</span> <span class="n">html</span>


<span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">Choices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">}:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
<p>Let's try it:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New thing: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>And what if we try to pass something else than the available choices? It fails, as expected:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropChoiceError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">type</span><span class="p">:</span> <span class="err">`</span><span class="n">stuff</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">choice</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">])</span>
</pre></div>
</div></details><details id="props_default-choices" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Default choices</h3><a class="permalink" href="#props_default-choices" title="Permalink to here">¶</a></summary><div class="content"><p>But maybe we don't want to pass it and use a default value. What would the result be?</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">UnsetPropError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">type</span><span class="p">:</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
</pre></div>
<p>So we have to mark the <code>type</code> prop as required:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
    <span class="n">add_url</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="n">Choices</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">]</span>
</pre></div>
<p>So if we don't pass it, it fails earlier:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequiredPropError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">type</span><span class="p">:</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">required</span> <span class="n">prop</span> <span class="n">but</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
</pre></div>
<p>But it's not what we want, we want a default value.</p><p>In fact, you noticed that for types other than <code>Choices</code>, setting a value in <code>PropTypes</code> gives us a default value. But for <code>Choices</code> it's different, as the value is the list of choices.</p><p>For this, we have <code>DefaultChoices</code>: it work the same as <code>Choices</code>, but use the first entry in the list as the default value. And of course, as with other types having default, it cannot be <code>Required</code>.</p><p>Let's try it:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">DefaultChoices</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Required</span><span class="p">,</span> <span class="n">html</span>


<span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">DefaultChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">]</span>
</pre></div>
<div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todo/add&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>It works as expected.</p></div></details><details id="props_advanced-types" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Advanced types</h3><a class="permalink" href="#props_advanced-types" title="Permalink to here">¶</a></summary><div class="content"><p>Until then, we used simple types, but you can use more complicated ones.</p><p>So for example, we'll make the <code>add_url</code> prop to accept a function that will compute the url for us based on the <code>type</code> prop. But we also want to allow strings, and with a default value.</p><p>We can do that, with typing. Our function will take a string, the <code>type</code> and will return a string, the url.</p><p>So the <a href="https://docs.python.org/3.6/library/typing.html#typing.Callable">syntax</a> is <code>Callable[[str], str]</code> for the callable, and we use <code>Union</code> to accept things of type <code>Callable</code> or <code>str</code>:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">DefaultChoices</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Required</span><span class="p">,</span> <span class="n">html</span>


<span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/todo/add&quot;</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">DefaultChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">):</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_url</span>

        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">add_url</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">}:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
<p>First, let's try it without the <code>add_url</code> prop, as we have a default:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span>  <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>It should work too if we pass a string:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="s2">&quot;/todolist/add&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todolist/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>And now we can pass a function:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">make_url</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">/add&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="p">{</span><span class="n">make_url</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">add_url</span><span class="p">:</span>
<span class="err">`</span><span class="o">&lt;</span><span class="n">function</span> <span class="n">make_url</span> <span class="n">at</span> <span class="mh">0x7fe2ae87be18</span><span class="o">&gt;</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">function</span><span class="s1">&#39;&gt;, expected: Union[Callable[[str], str], str])</span>
</pre></div>
<p>Oh? Why? I passed a function accepting a string as argument and returning a string. Yes, but don't forget that types are checked! So we must add types to our function:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">make_url</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">/add&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="p">{</span><span class="n">make_url</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>And if we pass another type, the url should change accordingly:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="n">add_url</span><span class="o">=</span><span class="p">{</span><span class="n">make_url</span><span class="p">}</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>We can even make this function the default value for our prop:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">DefaultChoices</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Required</span><span class="p">,</span> <span class="n">html</span>


<span class="k">def</span> <span class="nf">make_url</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">/add&quot;</span>


<span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">add_url</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_url</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">DefaultChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">):</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_url</span>

        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">add_url</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">}:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
<div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/todo/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div></details></div></details><details id="dev-mode" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">dev-mode</h2><a class="permalink" href="#dev-mode" title="Permalink to here">¶</a></summary><div class="content"><p>Now you may start wondering... python typing is cumbersome and validating may take away some of our precious time.</p><p>Let's me answer that:</p><ol><li><p>No, typing is not cumbersome. It's really useful to spot bugs and add some self-documentation.</p></li><li><p>Yes, it takes away some of our precious time. But we got you covered.</p></li></ol><p>By default, <code>mixt</code> run in &quot;dev-mode&quot;. And in dev-mode, props are validated when passed to a component. When you are NOT in &quot;dev-mode&quot;, the validation is skipped. So in production, you can deactivate the dev-mode (we'll see how in a minute) and pass props very fast:</p><ul><li><p>we don't check required props (but that would fail if you try to use it in your compoment)</p></li><li><p>we don't check if a <code>Choices</code> prop is, indeed, in the list of choices</p></li><li><p>we don't check the type at all, so for example if you want to pass a list for a string, it will work but with understandable strange things happening in your <code>render</code> method.</p></li></ul><p>But you may say that it's in production that validation is important. Indeed. But of course your code is fully covered by tests, that you run in dev-mode, and so in production, you don't need this validation! And note that it's how React works, by the way, with <code>NODE_ENV=production</code>.</p><p>How to change dev-mode? We don't enforce any environment variable but we propose some functions. It's up to you to call them:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">set_dev_mode</span><span class="p">,</span> <span class="n">unset_dev_mode</span><span class="p">,</span> <span class="n">override_dev_mode</span><span class="p">,</span> <span class="n">in_dev_mode</span>

<span class="c1"># by default, dev-mode is active</span>
<span class="k">assert</span> <span class="n">in_dev_mode</span><span class="p">()</span>

<span class="c1"># you can unset the dev-mode</span>
<span class="n">unset_dev_mode</span><span class="p">()</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">in_dev_mode</span><span class="p">()</span>

<span class="c1"># and set it back</span>
<span class="n">set_dev_mode</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">in_dev_mode</span><span class="p">()</span>

<span class="c1"># set_dev_mode can take a boolean</span>
<span class="n">set_dev_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">in_dev_mode</span><span class="p">()</span>

<span class="n">set_dev_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">in_dev_mode</span><span class="p">()</span>

<span class="c1"># and we have a context manager to override for a block</span>
<span class="k">with</span> <span class="n">override_dev_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">in_dev_mode</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">override_dev_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">in_dev_mode</span><span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">in_dev_mode</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">in_dev_mode</span><span class="p">()</span>
</pre></div>
<p>So let's try this with the <code>type</code> prop. Remember, it looks like:</p><div class="code"><pre><span></span><span class="nb">type</span><span class="p">:</span> <span class="n">DefaultChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">]</span>
</pre></div>
<p>We try to pass another choice, first in dev-mode:</p><div class="code"><pre><span></span><span class="k">with</span> <span class="n">override_dev_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropChoiceError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoForm</span><span class="o">&gt;.</span><span class="n">type</span><span class="p">:</span> <span class="err">`</span><span class="n">stuff</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">choice</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">])</span>
</pre></div>
<p>It fails as expected.</p><p>And now by deactivating dev-mode:</p><div class="code"><pre><span></span><span class="k">with</span> <span class="n">override_dev_mode</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoForm</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/stuff/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New stuff: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
<p>It works, we have a todo type that was not in our choices that is used, and is in the <code>action</code> too. It's the work of your tests to ensure that you never pass invalid props, so you can be confident in production and deactivate dev-mode.</p></div></details><details id="components-cascade" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Components cascade</h2><a class="permalink" href="#components-cascade" title="Permalink to here">¶</a></summary><div class="content"><p>Now we have our form. What other components do we need for our todo list app?</p><p>Of course, we need a way to display a todo entry.</p><p>But what is a todo entry? Let's create a basic <code>TodoObject</code>:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
</pre></div>
<p>It's a very simple class, but you can use what you want, of course. It could be Django models, etc...</p><p>So we can create our <code>Todo</code> component, making it accept a required <code>TodoObject</code> as prop:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">Todo</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todo</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="n">TodoObject</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">todo</span><span class="o">.</span><span class="n">text</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</pre></div>
<p>And we can use it:</p><div class="code"><pre><span></span><span class="n">todo</span> <span class="o">=</span> <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">=</span><span class="p">{</span><span class="n">todo</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</pre></div>
<p>Now we want to have a list of todos. Let's create a <code>TodoList</code> component that will accept as props a list of <code>TodoObject</code>.</p><p>But what is different than our two other components, that only use html tags in their <code>render</code> method, it's that now we will encapsulate a component into another. Let's see how.</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoList</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todos</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TodoObject</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{[</span><span class="o">&lt;</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">=</span><span class="p">{</span><span class="n">todo</span><span class="p">}</span> <span class="o">/&gt;</span> <span class="k">for</span> <span class="n">todo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">todos</span><span class="p">]}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</pre></div>
<p>Yes, it's as simple as that: you use <code>&lt;Todo...&gt;</code> for the <code>Todo</code> component as you would use an HTML tag. The only difference is that for html tags, you don't need to import them directly (simple import <code>html</code> from <code>mixt</code>), and by convention we write them in lower-case. For normal components, you have to import them (you can still do <code>from mylib import components</code> and <code>&lt;components.MyComponent ...&gt;</code>) and use the exact case.</p><p>Notice how we required a list, and passed it into the <code>&lt;ul&gt;</code> via a list-comprehension in curly-braces.</p><p>You can do things differently if you want.</p><p>Like separating the list comprehension from the html:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">todos</span> <span class="o">=</span> <span class="p">[</span>
        <span class="o">&lt;</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">=</span><span class="p">{</span><span class="n">todo</span><span class="p">}</span> <span class="o">/&gt;</span>
        <span class="k">for</span> <span class="n">todo</span>
        <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">todos</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{</span><span class="n">todos</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</pre></div>
<p>Or in a dedicated method (that would be useful for testing):</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">render_todos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todos</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="o">&lt;</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">=</span><span class="p">{</span><span class="n">todo</span><span class="p">}</span> <span class="o">/&gt;</span>
        <span class="k">for</span> <span class="n">todo</span>
        <span class="ow">in</span> <span class="n">todos</span>
    <span class="p">]</span>

<span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">render_todos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">todos</span><span class="p">)}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</pre></div>
<p>It's up to you: at the end it's just python.</p><p>Let's see what is rendered by this component:</p><div class="code"><pre><span></span><span class="n">todos</span> <span class="o">=</span> <span class="p">[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">),</span> <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">),</span> <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoList</span> <span class="n">todos</span><span class="o">=</span><span class="p">{</span><span class="n">todos</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>bar<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>baz<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
<p>And finally we have our <code>TodoApp</code> component that encapsulate the form and the list:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoApp</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todos</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TodoObject</span><span class="p">]]</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">DefaultChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">,</span> <span class="s1">&#39;thing&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">The</span> <span class="s2">&quot;</span><span class="si">{self.type}</span><span class="s2">&quot;</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">TodoForm</span> <span class="nb">type</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">TodoList</span> <span class="n">todos</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">todos</span><span class="p">}</span> <span class="o">/&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">todos</span> <span class="o">=</span> <span class="p">[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">),</span> <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">),</span> <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">TodoList</span> <span class="n">todos</span><span class="o">=</span><span class="p">{</span><span class="n">todos</span><span class="p">}</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>bar<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>baz<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>Let's pass this HTML to an HTML beautifier:</p><div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New thing: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>bar<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>baz<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>And that's it, we have our todo-list app! To use it in a page, just create a component that will render the html base markup and integrate the <code>TodoApp</code> component in it. You don't even need a component:</p><div class="code"><pre><span></span><span class="n">todos</span> <span class="o">=</span> <span class="p">[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">),</span> <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">),</span> <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">TodoApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{</span><span class="n">todos</span><span class="p">}</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<p>The beautified output would be:</p><div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New thing: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>bar<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>baz<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div></details><details id="overriding-a-component" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Overriding a component</h2><a class="permalink" href="#overriding-a-component" title="Permalink to here">¶</a></summary><div class="content"><p>We have a generic todo-list, but following the available types of todo, we may want to have a &quot;todo-list&quot; and a &quot;thing-list&quot;.</p><p>We already have the todo list because our <code>TodoApp</code> has a type of <code>todo</code> by default.</p><p>So let's create a <code>ThingApp</code>.</p><details id="overriding-a-component_inheritance" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Inheritance</h3><a class="permalink" href="#overriding-a-component_inheritance" title="Permalink to here">¶</a></summary><div class="content"><p>The first way of doing this is to inherit from our <code>TodoApp</code>. But by inheriting we cannot remove props from the parent (it's not really true, we'll see this later), so we still have the <code>type</code> prop by default. But we don't want to accept anything else than &quot;thing&quot;. So we can redefine the <code>type</code> prop like this:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">ThingApp</span><span class="p">(</span><span class="n">TodoApp</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">DefaultChoices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;thing&#39;</span><span class="p">]</span>
</pre></div>
<p>Let's use this component:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>If we try to pass &quot;todo&quot; for the <code>type</code> props, it won't work:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropChoiceError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">ThingApp</span><span class="o">&gt;.</span><span class="n">type</span><span class="p">:</span> <span class="err">`</span><span class="n">todo</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">choice</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;thing&#39;</span><span class="p">])</span>
</pre></div>
<p>But still, it's strange to be able to pass a type.</p></div></details><details id="overriding-a-component_parent-components" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Parent components</h3><a class="permalink" href="#overriding-a-component_parent-components" title="Permalink to here">¶</a></summary><div class="content"><p>Let's try another way: A parent component. A component that does nothing else that doing things with its children and returning it. What we want here, is a component that will return a <code>TodoApp</code> with the <code>type</code> prop forced to &quot;thing&quot;.</p><p>Let's do this</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">ThingApp</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todos</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TodoObject</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="n">TodoApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">todos</span><span class="p">}</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="o">/&gt;</span>
</pre></div>
<div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New todo: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>It works, and this time, we cannot pass the <code>type</code> prop:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropNameError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">ThingApp</span><span class="o">&gt;.</span><span class="n">type</span><span class="p">:</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">an</span> <span class="n">allowed</span> <span class="n">prop</span>
</pre></div>
</div></details><details id="overriding-a-component_proptypes-dryness" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">PropTypes DRYness</h3><a class="permalink" href="#overriding-a-component_proptypes-dryness" title="Permalink to here">¶</a></summary><div class="content"><p>Notice how we had to define the type for the <code>todos</code> props. Both in <code>TodoApp</code> and <code>TodoThing</code>.</p><p>There are many ways to handle that.</p><p>The first one would be to ignore the type in <code>ThingApp</code> because it will be checked in <code>TodoApp</code>. So we'll use the type <code>Any</code>:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="c1">#...</span>

<span class="k">class</span> <span class="nc">ThingApp</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todos</span><span class="p">:</span> <span class="n">Any</span>

 <span class="c1">#...</span>
</pre></div>
<p>Let's try with a valid list of todos:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>But what if we pass something else?</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="s2">&quot;foo, bar&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TodoApp</span><span class="o">&gt;.</span><span class="n">todos</span><span class="p">:</span> <span class="err">`</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">str</span><span class="s1">&#39;&gt;, expected: List[TodoObject])</span>
</pre></div>
<p>It works as expected but the error is reported at the <code>TodoApp</code> level, which is perfectly normal.</p><p>Another way would be to defined the type at a higher level:</p><div class="code"><pre><span></span><span class="n">TodoObjects</span> <span class="o">=</span> <span class="n">Required</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">TodoObject</span><span class="p">]]</span>

<span class="k">class</span> <span class="nc">TodoApp</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todos</span><span class="p">:</span> <span class="n">TodoObjects</span>
 <span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">ThingApp</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todos</span><span class="p">:</span> <span class="n">TodoObjects</span>
 <span class="c1"># ...</span>
</pre></div>
<p>Now if we pass something else, we have the error reported at the correct level:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="s2">&quot;foo, bar&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropValueError</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">TodoThing</span><span class="o">&gt;.</span><span class="n">todos</span><span class="p">:</span> <span class="err">`</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="err">`</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">prop</span> <span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">str</span><span class="s1">&#39;&gt;, expected: List[TodoObject])</span>
</pre></div>
<p>But if you can't or don't want to do that, you can keep the type defined in <code>TodoApp</code> et use the <code>prop_type</code> class method of a component to get the type of a prop:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">ThingApp</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">todos</span><span class="p">:</span> <span class="n">TodoApp</span><span class="o">.</span><span class="n">prop_type</span><span class="p">(</span><span class="s2">&quot;todos&quot;</span><span class="p">)</span>
 <span class="c1"># ...</span>
</pre></div>
<p>But does it really matter to have the error raised for <code>ThingApp</code> or <code>TodoApp</code>? Because at the end, it's really <code>TodoApp</code> that have to do the check.</p><p>So this should be a way to do this in a more generic way..</p></div></details><details id="overriding-a-component_function" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Function</h3><a class="permalink" href="#overriding-a-component_function" title="Permalink to here">¶</a></summary><div class="content"><p>We saw earlier that a component can be a single function to render a component. It just have to return a component, an html tag. One difference with class components is that there is not <code>PropTypes</code> so no validation. But... it's exactly what we need.</p><p>We want our <code>ThingApp</code> to accept some props (the <code>todos</code> prop), and return a <code>TodoApp</code> with a specific <code>type</code> prop.</p><p>So we could do:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">ThingApp</span><span class="p">(</span><span class="n">todos</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="n">TodoApp</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="n">todos</span><span class="o">=</span><span class="p">{</span><span class="n">todos</span><span class="p">}</span> <span class="o">/&gt;</span>
</pre></div>
<p>Here we can see that we cannot pass <code>type</code> to <code>ThingsApp</code>, it is not a valid argument.</p><p>Let's try it:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>Here we have only one prop to pass so it's easy. But imagine if we have many ones. We can use the <code>{**props}</code> syntax:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">ThingApp</span><span class="p">(</span><span class="o">**</span><span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="n">TodoApp</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="p">{</span><span class="o">**</span><span class="n">props</span><span class="p">}</span> <span class="o">/&gt;</span>
</pre></div>
<p>And you can do with even fewer characters (if it counts):</p><div class="code"><pre><span></span><span class="n">ThingApp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">**</span><span class="n">props</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoApp</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="p">{</span><span class="o">**</span><span class="n">props</span><span class="p">}</span> <span class="o">/&gt;</span>
</pre></div>
<p>These two fonctions behave exactly the same.</p><p>And you cannot pass a <code>type</code> prop because it would be a python error, as it would be passed twice to <code>TodoApp</code>:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="ne">TypeError</span><span class="p">:</span> <span class="n">BaseMetaclass</span> <span class="nb">object</span> <span class="n">got</span> <span class="n">multiple</span> <span class="n">values</span> <span class="k">for</span> <span class="n">keyword</span> <span class="n">argument</span> <span class="s1">&#39;type&#39;</span>
</pre></div>
<p>(yes it talks about <code>BaseMetaclass</code> which is the metaclass that creates our components classes)</p><p>And any other wrong props would be validated by <code>TodoApp</code>:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="n">foo</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropNameError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TodoApp</span><span class="o">&gt;.</span><span class="n">foo</span><span class="p">:</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">an</span> <span class="n">allowed</span> <span class="n">prop</span>
</pre></div>
<p>With this in mind, we could have created a generic fonction that force the type of any component accepting a <code>type</code> prop:</p><div class="code"><pre><span></span><span class="n">Thingify</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">component</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">component</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="p">{</span><span class="o">**</span><span class="n">props</span><span class="p">}</span> <span class="o">/&gt;</span>
</pre></div>
<div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">Thingify</span> <span class="n">component</span><span class="o">=</span><span class="p">{</span><span class="n">TodoApp</span><span class="p">}</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>The rendered component is <code>TodoApp</code>, the <code>type</code> prop is &quot;thing&quot; and the other props (here only <code>todos</code>) are correctly passed.</p></div></details><details id="overriding-a-component_higher-order-components" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Higher-order components</h3><a class="permalink" href="#overriding-a-component_higher-order-components" title="Permalink to here">¶</a></summary><div class="content"><p>Now extend this concept to a more generic case: &quot;higher-order components&quot;. In <a href="https://reactjs.org/docs/higher-order-components.html">React a &quot;high order component&quot;</a>, is &quot;a function that takes a component and returns a new component.&quot;</p><p>The idea is:</p><div class="code"><pre><span></span><span class="n">EnhancedComponent</span> <span class="o">=</span> <span class="n">higherOrderComponent</span><span class="p">(</span><span class="n">WrappedComponent</span><span class="p">)</span>
</pre></div>
<p>A classic way of doing it is to return a new component class:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">higherOrderComponent</span><span class="p">(</span><span class="n">WrappedComponent</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">HOC</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">__display_name__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;higherOrderComponent(</span><span class="si">{</span><span class="n">WrappedComponent</span><span class="o">.</span><span class="n">__display_name__</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">(</span><span class="n">WrappedComponent</span><span class="o">.</span><span class="n">PropTypes</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">WrappedComponent</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">childre</span><span class="p">()}</span><span class="o">&lt;/</span><span class="n">WrappedComponent</span><span class="o">&gt;</span>

    <span class="k">return</span> <span class="n">HOC</span>
</pre></div>
<p>Notice how we set the <code>PropTypes</code> class to inherit from the one of the wrapped component, and how we pass all the props to the wrapped component, along with the children. With the returned component will accept the same props, with the same types, as the wrapped one.</p><p>And also notice the <code>__display_name__</code>. It will be used in exceptions to let you now the component that raised it. Here, without forcing it, it would have been set to <code>HOC</code>, which is not helpful. Instead, we indicate that it is a transformed version of the passed component.</p><p>Here it is a function that does nothing useful.</p><p>In our example we could have done this:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">thingify</span><span class="p">(</span><span class="n">WrappedComponent</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">HOC</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">__display_name__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;thingify(</span><span class="si">{</span><span class="n">WrappedComponent</span><span class="o">.</span><span class="n">__display_name__</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">(</span><span class="n">WrappedComponent</span><span class="o">.</span><span class="n">PropTypes</span><span class="p">):</span>
            <span class="n">__exclude__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">WrappedComponent</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">()}</span><span class="o">&lt;/</span><span class="n">WrappedComponent</span><span class="o">&gt;</span>

    <span class="k">return</span> <span class="n">HOC</span>
</pre></div>
<p>Two important things here:</p><ul><li><p>notice how we use <code>__exclude__ = {'type'}</code> to remove the <code>type</code> prop from the ones we inherit from <code>WrappedComponent.PropTypes</code>. So the returned component will expect the exact same props as the wrapped one, except for <code>type</code>.</p></li><li><p>we added <code>{self.children()}</code> in the rendered wrapped component, because even if we actually know that the component we'll wrap, <code>TodoApp</code>, doesn't take children (it could but it does nothing with them), we cannot say in advance that it will always be the case, and also that this higher-order component won't be used to wrap another component than <code>TodoApp</code>. So it's better to always do this.</p></li></ul><p>And now we can create our <code>ThingApp</code>:</p><div class="code"><pre><span></span><span class="n">ThingApp</span> <span class="o">=</span> <span class="n">thingify</span><span class="p">(</span><span class="n">TodoApp</span><span class="p">)</span>
</pre></div>
<p>And use it:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>If we try to pass the type:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="n">todos</span><span class="o">=</span><span class="p">{[</span><span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)]}</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;thing&quot;</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="n">mixt</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidPropNameError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">thingify</span><span class="p">(</span><span class="n">TodoApp</span><span class="p">)</span><span class="o">&gt;.</span><span class="n">type</span><span class="p">:</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">an</span> <span class="n">allowed</span> <span class="n">prop</span>
</pre></div>
<p>So as planned, we cannot pass the type. And notice how the <code>__display_name__</code> is used.</p><p>Let's think about how powerful this is.</p><p>Let say we want to keep our <code>TodoApp</code> take a list of <code>TodoObject</code>. But we want to get them from a &quot;source&quot;.</p><p>We can even directly write it this new higher-order-component in a generic way:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">from_data_source</span><span class="p">(</span><span class="n">WrappedComponent</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">,</span> <span class="n">get_source</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">HOC</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">__display_name__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;from_data_source(</span><span class="si">{</span><span class="n">WrappedComponent</span><span class="o">.</span><span class="n">__display_name__</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">(</span><span class="n">WrappedComponent</span><span class="o">.</span><span class="n">PropTypes</span><span class="p">):</span>
            <span class="n">__exclude__</span> <span class="o">=</span> <span class="p">{</span><span class="n">prop_name</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">props</span><span class="p">[</span><span class="n">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_source</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">&lt;</span><span class="n">WrappedComponent</span> <span class="p">{</span><span class="o">**</span><span class="n">props</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">()}</span><span class="o">&lt;/</span><span class="n">WrappedComponent</span><span class="o">&gt;</span>

    <span class="k">return</span> <span class="n">HOC</span>
</pre></div>
<p>This time, the function <code>from_data_source</code> takes two arguments in addition to the <code>WrappedComponent</code>:</p><ul><li><p><code>prop_name</code>: it's the name of the prop of the wrapped component to fill with some data</p></li><li><p><code>get_source</code>: it's a function that will be called to get the data</p></li></ul><p>Look how we inherited the <code>PropTypes</code> from the wrapped component and how we excluded <code>prop_name</code>. So we don't have (and can't) pass the data to our new component.</p><p>And then in <code>render</code>, we set a prop to pass to <code>WrappedComponent</code> with the result of a call to <code>get_source</code>.</p><p>So let's write a very simple function (this could be a complicated one with caching, filtering...) that take the props and the context, and returns some data:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">get_todos</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># here it could be a call to a database</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;fooooo&quot;</span><span class="p">),</span>
        <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;baaaar&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
<p>And we can compose our component:</p><div class="code"><pre><span></span><span class="n">SourcedTodoApp</span> <span class="o">=</span> <span class="n">from_data_source</span><span class="p">(</span><span class="n">TodoApp</span><span class="p">,</span> <span class="s1">&#39;todos&#39;</span><span class="p">,</span> <span class="n">get_todos</span><span class="p">)</span>
<span class="n">ThingApp</span> <span class="o">=</span> <span class="n">thingify</span><span class="p">(</span><span class="n">SourcedTodoApp</span><span class="p">)</span>
</pre></div>
<p>And run it:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">form</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;&lt;</span><span class="nt">ul</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>fooooo<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">li</span><span class="p">&gt;</span>baaaar<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>It works as expected, and the data is fetched only when the component needs to be rendered.</p></div></details></div></details><details id="context" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Context</h2><a class="permalink" href="#context" title="Permalink to here">¶</a></summary><div class="content"><p>So, we have a todo list, that can fetch data from an external source. But we may want the data to be different depending on the user.</p><p>What we can do, it's at the main level, get our user and passing it on every component to be sure that each component is able to get the current logged in user.</p><p>Wouldn't it be cumbersome?</p><p>Solving this use case is the exact purpose of the <code>Context</code> concept provided by <code>mixt</code>. It is, of course, <a href="https://reactjs.org/docs/context.html">inspired by the concept of context in React</a>.</p><p>And as they said:</p><blockquote><p>Context is designed to share data that can be considered “global” for a tree of React components, such as the current authenticated user, theme, or preferred language.</p></blockquote><p>Creating a context is as simple as creating a component, except that it will inherits from <code>BaseContext</code> and doesn't need a <code>render</code> method (it will render its children).</p><p>And it takes a <code>PropTypes</code> class, that define the types of data the context will accept and pass down the tree.</p><p>So let's create our context that will hold the id of the authenticated user.</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">BaseContext</span>

<span class="k">class</span> <span class="nc">UserContext</span><span class="p">(</span><span class="n">BaseContext</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">PropTypes</span><span class="p">:</span>
        <span class="n">authenticated_user_id</span><span class="p">:</span> <span class="n">Required</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</pre></div>
<p>Now, we want to update our <code>get_todos</code> method to take the <code>authenticated_user_id</code> into account.</p><p>Remember, we passed it the props and the context. The context will be useful here:</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">get_todos</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:[</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;1-1&quot;</span><span class="p">),</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;1-2&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;2-1&quot;</span><span class="p">),</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;2-2&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">}[</span><span class="n">context</span><span class="o">.</span><span class="n">authenticated_user_id</span><span class="p">]</span>
</pre></div>
<p>And now we can render our app with the context:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">UserContext</span> <span class="n">authenticated_user_id</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">UserContext</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">The</span> <span class="s2">&quot;thing&quot;</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;&lt;</span><span class="n">form</span><span class="o">&gt;...&lt;/</span><span class="n">form</span><span class="o">&gt;&lt;</span><span class="n">ul</span><span class="o">&gt;&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
<p>We can see the todo entries for the user 1.</p><p>Let's try with the user 2:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">UserContext</span> <span class="n">authenticated_user_id</span><span class="o">=</span><span class="mi">2</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">UserContext</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">The</span> <span class="s2">&quot;thing&quot;</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;&lt;</span><span class="n">form</span><span class="o">&gt;...&lt;/</span><span class="n">form</span><span class="o">&gt;&lt;</span><span class="n">ul</span><span class="o">&gt;&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
<p>We can see the todo entries for the user 2.</p><p>In this case of course we could have passed the user id as a prop. But imagine the todo app being deep in the components tree, it's a lot easier to pass it this way.</p><p>But as said in the React documentation:</p><blockquote><p>Don’t use context just to avoid passing props a few levels down. Stick to cases where the same data needs to be accessed in many components at multiple levels.</p></blockquote><p>When there is no context, the <code>context</code> argument of the <code>render</code> method is set to <code>EmptyContext</code> and not to <code>None</code>. So you can directly use the <code>has_prop</code> method to check if a prop is available via the context.</p><p>Let's update the <code>get_todos</code> functions to return an empty list of todo objects if there is not authenticated user.</p><div class="code"><pre><span></span><span class="k">def</span> <span class="nf">get_todos</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">has_prop</span><span class="p">(</span><span class="s1">&#39;authenticated_user_id&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">authenticated_user_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:[</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;1-1&quot;</span><span class="p">),</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;1-2&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;2-1&quot;</span><span class="p">),</span>
            <span class="n">TodoObject</span><span class="p">(</span><span class="s2">&quot;2-2&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">}[</span><span class="n">context</span><span class="o">.</span><span class="n">authenticated_user_id</span><span class="p">]</span>
</pre></div>
<p>Let's try this:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span><span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">The</span> <span class="s2">&quot;thing&quot;</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;&lt;</span><span class="n">form</span><span class="o">&gt;...&lt;/</span><span class="n">form</span><span class="o">&gt;&lt;</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
<p>And it still works with a user in the context:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">UserContext</span> <span class="n">authenticated_user_id</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">UserContext</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">The</span> <span class="s2">&quot;thing&quot;</span> <span class="nb">list</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;&lt;</span><span class="n">form</span><span class="o">&gt;...&lt;/</span><span class="n">form</span><span class="o">&gt;&lt;</span><span class="n">ul</span><span class="o">&gt;&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;&lt;/</span><span class="n">ul</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
<p><strong>Important note about contexts</strong>: you can have many contexts! But defining the same prop in many contexts may lead to undefined behaviour.</p></div></details><details id="style-and-javascript" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Style and Javascript</h2><a class="permalink" href="#style-and-javascript" title="Permalink to here">¶</a></summary><div class="content"><p>Everybody loves a beautiful design, and maybe some interaction.</p><p>It is easily doable: we generate HTML and HTML can contains some CSS and JS.</p><p>Let's add some interaction first: when adding an item in the <code>TodoForm</code>, let's add it to the list.</p><p>First we add in our <code>TodoForm</code> component a <code>render_javascript</code> method that will host our (bad, we could do better but it's not the point) javascript:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">render_javascript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Raw</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">function on_todo_add_submit(form) {</span>
<span class="s2">    var text = form.todo.value;</span>
<span class="s2">    alert(text);</span>
<span class="s2">}</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
<p>To start we only display the new todo text.</p><p>Now update our <code>render</code> method to return this javascript (note that the use of a <code>render_javascript</code> method is only to separate concerns, it could have been in the <code>render</code> method directly.</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="c1"># ...</span>

        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">render_javascript</span><span class="p">(</span><span class="n">context</span><span class="p">)}</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">add_url</span><span class="p">}</span> <span class="n">onsubmit</span><span class="o">=</span><span class="s2">&quot;return on_todo_add_submit(this);&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">}:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                    <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">Fragment</span><span class="o">&gt;</span>
</pre></div>
<p>Notice the <code>Fragment</code> tag. It's a way to encapsulate many elements to be returned, like in React. It could have been a simple list but with comas at the end:</p><div class="code"><pre><span></span><span class="k">return</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;...&lt;/</span><span class="n">script</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="n">form</span><span class="o">&gt;</span>
        <span class="o">...</span>
    <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
<span class="p">]</span>
</pre></div>
<p>Now we want to add an item to the list. It's not the role of the <code>TodoForm</code> to do this, but to the list. So we'll add some JS in the <code>TodoList</code> component: a function that take some text and create a new entry.</p><p>As for <code>TodoForm</code>, we add a <code>render_javascript</code> method with (still bad) javascript:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoList</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">render_javascript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

        <span class="n">todo_placeholder</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">=</span><span class="p">{</span><span class="n">TodoObject</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;placeholder&#39;</span><span class="p">)}</span> <span class="o">/&gt;</span>

        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Raw</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">TODO_TEMPLATE = &quot;</span><span class="si">%s</span><span class="s2">&quot;;</span>
<span class="s2">function add_todo(text) {</span>
<span class="s2">    var html = TODO_TEMPLATE.replace(&quot;placeholder&quot;, text);</span>
<span class="s2">    var ul = document.querySelector(&#39;#todo-items&#39;);</span>
<span class="s2">    ul.innerHTML = html + ul.innerHTML;</span>
<span class="s2">}</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">todo_placeholder</span><span class="p">))</span>
</pre></div>
<p>And we update our <code>render</code> method to add the <code>&lt;script&gt;</code> tag and an <code>id</code> to the <code>ul</code> tag, used in the javascript:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoList</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">render_javascript</span><span class="p">(</span><span class="n">context</span><span class="p">)}</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">ul</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;todo-items&quot;</span><span class="o">&gt;</span><span class="p">{[</span><span class="o">&lt;</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">=</span><span class="p">{</span><span class="n">todo</span><span class="p">}</span> <span class="o">/&gt;</span> <span class="k">for</span> <span class="n">todo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">todos</span><span class="p">]}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">Fragment</span><span class="o">&gt;</span>
</pre></div>
<p>And now we can update the <code>render_javascript</code> method of the <code>TodoForm</code> component to use our new <code>add_toto</code> javascript function:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">render_javascript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Raw</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">function on_todo_add_submit(form) {</span>
<span class="s2">    var text = form.todo.value;</span>
<span class="s2">    add_todo(text);</span>
<span class="s2">}</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
<p>And that's all. Nothing special, in fact.</p><p>But let's take a look at the output of ou <code>TodoApp</code>:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">UserContext</span> <span class="n">authenticated_user_id</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">User</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<p>The beautified output is:</p><div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kd">function</span> <span class="nx">on_todo_add_submit</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="nx">add_todo</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;return on_todo_add_submit(this);&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New thing: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="nx">TODO_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&lt;li&gt;placeholder&lt;/li&gt;&quot;</span><span class="p">;</span>

        <span class="kd">function</span> <span class="nx">add_todo</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">TODO_TEMPLATE</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;placeholder&quot;</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#todo-items&#39;</span><span class="p">);</span>
            <span class="nx">ul</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span> <span class="o">+</span> <span class="nx">ul</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todo-items&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-1<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-2<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>So we have many <code>script</code> tag. It could be great to have only one.</p><details id="style-and-javascript_collectors" class="doc-part rst-section" tabindex="-1" open><summary><h3 class="h">Collectors</h3><a class="permalink" href="#style-and-javascript_collectors" title="Permalink to here">¶</a></summary><div class="content"><p><code>mixt</code> comes with a way to &quot;collect&quot; parts of what is rendered to put them somewhere else. We have at our disposal two simple collectors, to be used as components: <code>JSCollector</code> and <code>CSSCollector</code>.</p><p>These components collect parts of their children tree.</p><details id="style-and-javascript_collectors_collector-collect" class="doc-part rst-section" tabindex="-1" open><summary><h4 class="h">Collector.Collect</h4><a class="permalink" href="#style-and-javascript_collectors_collector-collect" title="Permalink to here">¶</a></summary><div class="content"><p>The first way is by using the collector <code>Collect</code> tag.</p><p>First let's change our main call:</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">JSCollector</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">JSCollector</span> <span class="n">render_position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">UserContext</span> <span class="n">authenticated_user_id</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="n">User</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">JSCollector</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<p>This will collect the content of all the <code>JSCollector.Collect</code> tag.</p><p>Let's update our <code>TodoForm</code> and replace our <code>script</code> tag by a <code>JSCollector.Collect</code> tag:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoForm</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">):</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_url</span>

        <span class="k">return</span> \
                <span class="o">&lt;</span><span class="n">JSCollector</span><span class="o">.</span><span class="n">Collect</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">render_javascript</span><span class="p">(</span><span class="n">context</span><span class="p">)}</span><span class="o">&lt;/</span><span class="n">JSCollector</span><span class="o">.</span><span class="n">Collect</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">add_url</span><span class="p">}</span> <span class="n">onsubmit</span><span class="o">=</span><span class="s2">&quot;return on_todo_add_submit(this);&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">New</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">}:</span> <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;</span><span class="n">itext</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;todo&quot;</span> <span class="o">/&gt;</span>
                    <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Add</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">Fragment</span><span class="o">&gt;</span>
</pre></div>
<p>We can do the same with the <code>TodoList</code>:</p><div class="code"><pre><span></span><span class="k">class</span> <span class="nc">TodoList</span><span class="p">(</span><span class="n">Element</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">JSCollector</span><span class="o">.</span><span class="n">Collect</span><span class="o">&gt;</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">render_javascript</span><span class="p">(</span><span class="n">context</span><span class="p">)}</span><span class="o">&lt;/</span><span class="n">JSCollector</span><span class="o">.</span><span class="n">Collect</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">ul</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;todo-items&quot;</span><span class="o">&gt;</span><span class="p">{[</span><span class="o">&lt;</span><span class="n">Todo</span> <span class="n">todo</span><span class="o">=</span><span class="p">{</span><span class="n">todo</span><span class="p">}</span> <span class="o">/&gt;</span> <span class="k">for</span> <span class="n">todo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">todos</span><span class="p">]}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">Fragment</span><span class="o">&gt;</span>
</pre></div>
<p>Now let's run our updated code:</p><div class="code"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">JSCollector</span> <span class="n">render_position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">UserContext</span> <span class="n">authenticated_user_id</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="n">User</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">JSCollector</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<p>The beautified output is:</p><div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;return on_todo_add_submit(this);&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New thing: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todo-items&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-1<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-2<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">function</span> <span class="nx">on_todo_add_submit</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="nx">add_todo</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">TODO_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&lt;li&gt;placeholder&lt;/li&gt;&quot;</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">add_todo</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">TODO_TEMPLATE</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;placeholder&quot;</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#todo-items&#39;</span><span class="p">);</span>
        <span class="nx">ul</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span> <span class="o">+</span> <span class="nx">ul</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
<p>As you can see, all the scripts are in a single <code>script</code> tag, at the end. More precisely, at the end of where the <code>JSCollector</code> tag was, because we used <code>render_position=&quot;after&quot;</code>. Another possibility is <code>render_position=&quot;before&quot;</code> to put this where the <code>JSCollector</code> tag started.</p><p>All of this work exactly the same way for the <code>CSSCollector</code> tag, where content is put in a <code>&lt;style type=&quot;text/css&gt;</code> tag.</p></div></details><details id="style-and-javascript_collectors_render-js-css-methods" class="doc-part rst-section" tabindex="-1" open><summary><h4 class="h">render_[js|css] methods</h4><a class="permalink" href="#style-and-javascript_collectors_render-js-css-methods" title="Permalink to here">¶</a></summary><div class="content"><p>As using JS/CSS is quite common in the HTML world, we added some sugar to make all of this even easier to do.</p><p>If you have a <code>render_js</code> method, the <code>JSCollector</code> will automatically collect the result of this method. Same for <code>CSSSelector</code> and the <code>render_css</code> method.</p><p>With this, no need for a <code>JSCollector.Collect</code> tag.</p><p>To make this work in our example, in <code>TodoForm</code> and <code>TodoList</code>:</p><ul><li><p>remove the <code>JSCollector.Collect</code> tags</p></li><li><p>remove the now unneeded <code>Fragment</code> tags</p></li><li><p>rename the <code>render_javascript</code> methods to <code>render_js</code>.</p></li><li><p>remove the call to <code>html.Raw</code> in <code>render_js</code> as it's not needed when the collector calls <code>render_js</code> itself: if the output is a string, it is considered a &quot;raw&quot; one</p></li></ul><p>This way we have exactly the same result.</p></div></details><details id="style-and-javascript_collectors_render-js-css-global-methods" class="doc-part rst-section" tabindex="-1" open><summary><h4 class="h">render_[js|css]_global methods</h4><a class="permalink" href="#style-and-javascript_collectors_render-js-css-global-methods" title="Permalink to here">¶</a></summary><div class="content"><p>It works now because we only have one instance of a child with a <code>render_js</code> method.</p><p>But if we have many children, this method will be called for each child. If fact, it should only contains code that is very specific to this instance.</p><p>To serve js/css only once for a Component class, we have to use <code>render_js_global</code> or <code>render_css_global</code> (expected to be <code>classmethod</code>)</p><p>It will be collected the first time, and only the first time, an instance is found, before collecting the <code>render_js</code> method.</p><p>So here, we can change our <code>render_js</code> to <code>render_js_global</code>, decorate them with <code>@classmethod</code> and it will still work the same.</p></div></details><details id="style-and-javascript_collectors_references" class="doc-part rst-section" tabindex="-1" open><summary><h4 class="h">references</h4><a class="permalink" href="#style-and-javascript_collectors_references" title="Permalink to here">¶</a></summary><div class="content"><p>We now are able to regroup javascript or style. But what if we want to put it elsewhere, like in the <code>head</code> tag or at the end of the <code>body</code> tag?</p><p>It's possible with references, aka &quot;refs&quot;. It's the same context as in React, without the DOM part of course.</p><p>You create a ref, pass it to a component, and you can use it anywhere.</p><p>Let's update our main code to do this.</p><p>First we create a ref.</p><div class="code"><pre><span></span><span class="kn">from</span> <span class="nn">mixt</span> <span class="kn">import</span> <span class="n">Ref</span>

<span class="n">js_ref</span> <span class="o">=</span> <span class="n">Ref</span><span class="p">()</span>
</pre></div>
<p>This will create a new object that will hold a reference to a component. In a component, you don't need to import <code>Ref</code> and can use <code>js_ref = self.add_ref()</code>, but we are not in a component here.</p><p>To save a ref, we simply pass it to the <code>ref</code> prop:</p><div class="code"><pre><span></span><span class="o">&lt;</span><span class="n">JSCollector</span> <span class="n">ref</span><span class="o">=</span><span class="p">{</span><span class="n">js_ref</span><span class="p">}</span> <span class="o">&gt;...&lt;/</span><span class="n">JSCollector</span><span class="o">&gt;</span>
</pre></div>
<p>Notice that we removed the <code>render_position</code> prop, because now we don't want the JS to be put before or after the tag, but elsewhere.</p><p>To access the component referenced by a ref, use the <code>current</code> attribute:</p><div class="code"><pre><span></span><span class="n">js_collector</span> <span class="o">=</span> <span class="n">js_ref</span><span class="o">.</span><span class="n">current</span>
</pre></div>
<p>Of course this can be done only AFTER the rendering.</p><p>How can we use this to add a <code>script</code> tag in our <code>head</code>.</p><p>First update our html to include the classic <code>html</code>, <code>head</code> and <code>body</code> tags:</p><div class="code"><pre><span></span><span class="k">return</span> <span class="nb">str</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">JSCollector</span> <span class="n">ref</span><span class="o">=</span><span class="p">{</span><span class="n">js_ref</span><span class="p">}</span> <span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">UserContext</span> <span class="n">authenticated_user_id</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">ThingApp</span> <span class="o">/&gt;</span>
                <span class="o">&lt;/</span><span class="n">UserContext</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">JSCollector</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
<p>At this point we don't have any <code>script</code> tag in the output:</p><div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;return on_todo_add_submit(this);&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New thing: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todo-items&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-1<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-2<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>First thing to know: a collector is able to render all the things it collected by calliing its <code>render_collected</code> method.</p><p>And remembering that it already includes the <code>script</code> tag, we may want to do this:</p><div class="code"><pre><span></span><span class="c1"># ...</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="n">js_ref</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">render_collected</span><span class="p">()}</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="c1"># ...</span>
</pre></div>
<p>but this doesn't work:</p><div class="code"><pre><span></span><span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;NoneType&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;render_collected&#39;</span>
</pre></div>
<p>It's because we try to access the current value at render time. It must be done after.</p><p>For this, we can use a feature of <code>mixt</code>: if something added to the tree is a callable, it will be called after the rendering, when converting to string.</p><p>So we can use for example a lambda:</p><div class="code"><pre><span></span><span class="c1"># ...</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="k">lambda</span><span class="p">:</span> <span class="n">js_ref</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">render_collected</span><span class="p">()}</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="c1"># ...</span>
</pre></div>
<p>And now it works:</p><div class="code"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
        <span class="kd">function</span> <span class="nx">on_todo_add_submit</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="nx">add_todo</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">TODO_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&lt;li&gt;placeholder&lt;/li&gt;&quot;</span><span class="p">;</span>

        <span class="kd">function</span> <span class="nx">add_todo</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">TODO_TEMPLATE</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;placeholder&quot;</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#todo-items&#39;</span><span class="p">);</span>
            <span class="nx">ul</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span> <span class="o">+</span> <span class="nx">ul</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>The &quot;thing&quot; list<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/thing/add&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;return on_todo_add_submit(this);&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>New thing: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;todo&quot;</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Add<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;todo-items&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-1<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>1-2<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div></details></div></details></div></details><details id="user-guide-conclusion" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">User guide conclusion</h2><a class="permalink" href="#user-guide-conclusion" title="Permalink to here">¶</a></summary><p class="content">Hurray we made it! All the main features of <code>mixt</code> explained. You can now use <code>mixt</code> in your own projects.</p></details><details id="next" class="doc-part rst-section" tabindex="-1" open><summary><h2 class="h">Next</h2><a class="permalink" href="#next" title="Permalink to here">¶</a></summary><p class="content">As a next step, you may want to read <a href="api.html">the API documentation</a>.</p></details></div></div></main><script type="text/javascript" src="vendored.js"></script><script type="text/javascript" src="global.js"></script><script type="text/javascript"></script></body></html>